<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMB-India Production Defects Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            padding: 24px;
            color: #e2e8f0;
        }
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 32px;
        }
        header h1 {
            font-size: 2.2em;
            background: linear-gradient(135deg, #38bdf8, #818cf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        header p {
            color: #94a3b8;
            font-size: 1.05em;
        }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 28px;
        }
        .stat-card {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 14px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .stat-card .number {
            font-size: 2.6em;
            font-weight: 800;
            line-height: 1.1;
        }
        .stat-card .label {
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #94a3b8;
            margin-top: 6px;
        }
        .stat-card.total .number { color: #38bdf8; }
        .stat-card.open .number { color: #fbbf24; }
        .stat-card.progress .number { color: #a78bfa; }
        .stat-card.done .number { color: #34d399; }
        .stat-card.critical .number { color: #f87171; }
        .stat-card.cancelled .number { color: #64748b; }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 28px;
        }
        .chart-card {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 14px;
            padding: 24px;
            backdrop-filter: blur(10px);
        }
        .chart-card h3 {
            font-size: 1.1em;
            color: #cbd5e1;
            margin-bottom: 16px;
            text-align: center;
        }
        .chart-card.full-width {
            grid-column: 1 / -1;
        }

        .table-card {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 14px;
            padding: 24px;
            backdrop-filter: blur(10px);
            overflow-x: auto;
        }
        .table-card h3 {
            font-size: 1.1em;
            color: #cbd5e1;
            margin-bottom: 16px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            text-align: left;
            padding: 10px 14px;
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #94a3b8;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        td {
            padding: 12px 14px;
            font-size: 0.9em;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: #e2e8f0;
        }
        tr:hover td { background: rgba(255,255,255,0.03); }
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }
        .badge-todo { background: #1e3a5f; color: #38bdf8; }
        .badge-inprogress { background: #3b1f6e; color: #c4b5fd; }
        .badge-done { background: #064e3b; color: #6ee7b7; }
        .badge-qa { background: #164e63; color: #67e8f9; }
        .badge-cancelled { background: #1e293b; color: #64748b; }
        .badge-p1 { background: #450a0a; color: #fca5a5; }
        .badge-p2 { background: #431407; color: #fdba74; }
        .badge-p3 { background: #1a2e05; color: #bef264; }
        .link {
            color: #38bdf8;
            text-decoration: none;
        }
        .link:hover { text-decoration: underline; }
        .timestamp {
            text-align: center;
            color: #475569;
            font-size: 0.85em;
            margin-top: 24px;
        }
        @media (max-width: 768px) {
            .charts-grid { grid-template-columns: 1fr; }
            .stats-row { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
<div class="dashboard">
    <header>
        <h1>IMB-India Production Defects</h1>
        <p>JIRA Project: IM &mdash; Blend Production Environment</p>
    </header>

    <div class="stats-row">
        <div class="stat-card total"><div class="number">24</div><div class="label">Total Defects</div></div>
        <div class="stat-card open"><div class="number">4</div><div class="label">To Do</div></div>
        <div class="stat-card progress"><div class="number">2</div><div class="label">In Progress</div></div>
        <div class="stat-card done"><div class="number">10</div><div class="label">Done</div></div>
        <div class="stat-card critical"><div class="number">6</div><div class="label">Ready for QA</div></div>
        <div class="stat-card cancelled"><div class="number">2</div><div class="label">Cancelled</div></div>
    </div>

    <div class="charts-grid">
        <div class="chart-card">
            <h3>Defects by Status</h3>
            <canvas id="statusChart"></canvas>
        </div>
        <div class="chart-card">
            <h3>Defects by Priority</h3>
            <canvas id="priorityChart"></canvas>
        </div>
        <div class="chart-card">
            <h3>Defects by Assignee</h3>
            <canvas id="assigneeChart"></canvas>
        </div>
        <div class="chart-card">
            <h3>Defects Created Over Time (Monthly)</h3>
            <canvas id="trendChart"></canvas>
        </div>
        <div class="chart-card full-width">
            <h3>Open / Active Defects by Priority</h3>
            <canvas id="openPriorityChart"></canvas>
        </div>
    </div>

    <div class="table-card">
        <h3>All IMB Defects (24)</h3>
        <table>
            <thead>
                <tr>
                    <th>Key</th>
                    <th>Summary</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Assignee</th>
                    <th>Created</th>
                </tr>
            </thead>
            <tbody id="defectsTable"></tbody>
        </table>
    </div>

    <div class="timestamp">Data sourced from Blend JIRA (blendlabs.atlassian.net) &mdash; Last refreshed: <span id="refreshTime"></span></div>
</div>

<script>
// ── IMB Defect Data from JIRA ──
const defects = [
  { key:"IM-190", summary:"Swap borrower option not grayed out when TRID triggered", status:"To Do", priority:"P3 (Minor)", assignee:"Siddhartha Paul", created:"2026-02-09" },
  { key:"IM-187", summary:"Export fails when user tries to edit fields on Blend side", status:"To Do", priority:"P3 (Minor)", assignee:"Ajay Shekar", created:"2026-02-03" },
  { key:"IM-186", summary:"Encompass ID changed to loan ID after export", status:"To Do", priority:"P2 (Major)", assignee:"Ajay Shekar", created:"2026-02-03" },
  { key:"IM-183", summary:"Encompass two way sync field mapping mismatch - Part 3", status:"Done", priority:"P3 (Minor)", assignee:"Siddhartha Paul", created:"2026-01-27" },
  { key:"IM-176", summary:"Borrower getting added in UI without all consent", status:"Ready for QA", priority:"P3 (Minor)", assignee:"Siddhartha Paul", created:"2026-01-22" },
  { key:"IM-175", summary:"Cap for max limit in swap borrower modal", status:"Ready for QA", priority:"P3 (Minor)", assignee:"Siddhartha Paul", created:"2026-01-21" },
  { key:"IM-163", summary:"Fix 400 errors from Desktop Originator for DU tenants", status:"Ready for QA", priority:"P3 (Minor)", assignee:"Akash Pai", created:"2026-01-11" },
  { key:"IM-154", summary:"Encompass two way sync field mapping mismatch - Part 2", status:"Ready for QA", priority:"P3 (Minor)", assignee:"Siddhant Vyas", created:"2026-01-09" },
  { key:"IM-153", summary:"Encompass two way sync field mapping mismatch - Part 1", status:"Done", priority:"P3 (Minor)", assignee:"Siddhant Vyas", created:"2026-01-09" },
  { key:"IM-125", summary:"Non-QM Loans Unable to Generate Pre-Approval Letter", status:"Cancelled", priority:"P3 (Minor)", assignee:"Siddhant Vyas", created:"2025-12-23" },
  { key:"IM-124", summary:"Disclosure emails from old organization email", status:"Dev in Progress", priority:"P2 (Major)", assignee:"Siddhant Vyas", created:"2025-12-23" },
  { key:"IM-123", summary:"Email From Address accepts invalid email format", status:"Done", priority:"P2 (Major)", assignee:"Siddhant Vyas", created:"2025-12-21" },
  { key:"IM-120", summary:"User unable to run DO", status:"Done", priority:"P3 (Minor)", assignee:"Siddhartha Paul", created:"2025-12-17" },
  { key:"IM-118", summary:"Unable to perform actions in sandbox environment", status:"Ready for QA", priority:"P3 (Minor)", assignee:"Siddhartha Paul", created:"2025-12-17" },
  { key:"IM-100", summary:"Dependents defaulting to 0 for bridge loans", status:"Done", priority:"P3 (Minor)", assignee:"Siddhartha Paul", created:"2025-12-04" },
  { key:"IM-94",  summary:"User unable to run interim DO", status:"Cancelled", priority:"P3 (Minor)", assignee:"Siddhartha Paul", created:"2025-12-04" },
  { key:"IM-84",  summary:"DO credentials removed after adding in user profile", status:"Done", priority:"P1 (Critical)", assignee:"Siddhartha Paul", created:"2025-12-02" },
  { key:"IM-77",  summary:"Error sending Pre-approval letter for NON-QM loans", status:"Done", priority:"P2 (Major)", assignee:"Siddhant Vyas", created:"2025-12-01" },
  { key:"IM-67",  summary:"DO not working as expected", status:"Done", priority:"P3 (Minor)", assignee:"Siddhartha Paul", created:"2025-11-19" },
  { key:"IM-54",  summary:"Edit option missing for estimated property value (bridge loan)", status:"To Do", priority:"P3 (Minor)", assignee:"Hemanth Surya", created:"2025-11-12" },
  { key:"IM-9",   summary:"Re-Run all AUS functionality not working", status:"Done", priority:"P3 (Minor)", assignee:"Darshan Garje", created:"2025-11-04" },
  { key:"IM-10",  summary:"Re-run AUS button not disabled after final DO", status:"Done", priority:"P2 (Major)", assignee:"Akash Pai", created:"2025-10-29" },
  { key:"IM-140", summary:"Clarksville,MD not showing as city/state option", status:"Ready for QA", priority:"P2 (Major)", assignee:"Hemanth Surya", created:"2025-09-26" },
  { key:"IM-162", summary:"Mobile disclosure tracker not accurate (USBank)", status:"Dev in Progress", priority:"P2 (Major)", assignee:"Melissa Cohen", created:"2024-11-22" },
];

// ── Helpers ──
function count(arr, key, val) { return arr.filter(d => d[key] === val).length; }
function countIncludes(arr, key, val) { return arr.filter(d => d[key].includes(val)).length; }

// ── Render timestamp ──
document.getElementById('refreshTime').textContent = new Date().toLocaleString();

// ── Chart.js defaults ──
Chart.defaults.color = '#94a3b8';
Chart.defaults.borderColor = 'rgba(255,255,255,0.06)';

// ── 1. Status Doughnut ──
new Chart(document.getElementById('statusChart'), {
  type: 'doughnut',
  data: {
    labels: ['To Do', 'Dev in Progress', 'Ready for QA', 'Done', 'Cancelled'],
    datasets: [{
      data: [
        count(defects,'status','To Do'),
        count(defects,'status','Dev in Progress'),
        count(defects,'status','Ready for QA'),
        count(defects,'status','Done'),
        count(defects,'status','Cancelled')
      ],
      backgroundColor: ['#fbbf24','#a78bfa','#22d3ee','#34d399','#64748b'],
      borderWidth: 0
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'bottom', labels: { padding: 16, usePointStyle: true } }
    }
  }
});

// ── 2. Priority Bar ──
new Chart(document.getElementById('priorityChart'), {
  type: 'bar',
  data: {
    labels: ['P1 (Critical)', 'P2 (Major)', 'P3 (Minor)'],
    datasets: [{
      label: 'Defects',
      data: [
        countIncludes(defects,'priority','P1'),
        countIncludes(defects,'priority','P2'),
        countIncludes(defects,'priority','P3')
      ],
      backgroundColor: ['#f87171','#fb923c','#a3e635'],
      borderRadius: 6,
      borderSkipped: false
    }]
  },
  options: {
    responsive: true,
    indexAxis: 'y',
    plugins: { legend: { display: false } },
    scales: {
      x: { beginAtZero: true, ticks: { stepSize: 1 } }
    }
  }
});

// ── 3. Assignee Horizontal Bar ──
const assigneeCounts = {};
defects.forEach(d => { assigneeCounts[d.assignee] = (assigneeCounts[d.assignee] || 0) + 1; });
const sortedAssignees = Object.entries(assigneeCounts).sort((a,b) => b[1]-a[1]);
new Chart(document.getElementById('assigneeChart'), {
  type: 'bar',
  data: {
    labels: sortedAssignees.map(a => a[0]),
    datasets: [{
      label: 'Defects',
      data: sortedAssignees.map(a => a[1]),
      backgroundColor: ['#818cf8','#38bdf8','#34d399','#fbbf24','#f472b6','#fb923c'],
      borderRadius: 6,
      borderSkipped: false
    }]
  },
  options: {
    responsive: true,
    indexAxis: 'y',
    plugins: { legend: { display: false } },
    scales: { x: { beginAtZero: true, ticks: { stepSize: 1 } } }
  }
});

// ── 4. Monthly Trend Line ──
const monthCounts = {};
defects.forEach(d => {
  const m = d.created.substring(0, 7); // YYYY-MM
  monthCounts[m] = (monthCounts[m] || 0) + 1;
});
const sortedMonths = Object.keys(monthCounts).sort();
new Chart(document.getElementById('trendChart'), {
  type: 'line',
  data: {
    labels: sortedMonths.map(m => {
      const [y, mo] = m.split('-');
      return new Date(y, mo-1).toLocaleString('default',{month:'short',year:'2-digit'});
    }),
    datasets: [{
      label: 'Defects Created',
      data: sortedMonths.map(m => monthCounts[m]),
      borderColor: '#818cf8',
      backgroundColor: 'rgba(129,140,248,0.15)',
      fill: true,
      tension: 0.3,
      pointRadius: 5,
      pointBackgroundColor: '#818cf8'
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { display: false } },
    scales: {
      y: { beginAtZero: true, ticks: { stepSize: 1 } }
    }
  }
});

// ── 5. Open defects by priority ──
const openDefects = defects.filter(d => !['Done','Cancelled'].includes(d.status));
new Chart(document.getElementById('openPriorityChart'), {
  type: 'bar',
  data: {
    labels: ['P1 (Critical)', 'P2 (Major)', 'P3 (Minor)'],
    datasets: [
      { label:'To Do', data:[
        openDefects.filter(d=>d.status==='To Do'&&d.priority.includes('P1')).length,
        openDefects.filter(d=>d.status==='To Do'&&d.priority.includes('P2')).length,
        openDefects.filter(d=>d.status==='To Do'&&d.priority.includes('P3')).length
      ], backgroundColor:'#fbbf24', borderRadius:4 },
      { label:'Dev in Progress', data:[
        openDefects.filter(d=>d.status==='Dev in Progress'&&d.priority.includes('P1')).length,
        openDefects.filter(d=>d.status==='Dev in Progress'&&d.priority.includes('P2')).length,
        openDefects.filter(d=>d.status==='Dev in Progress'&&d.priority.includes('P3')).length
      ], backgroundColor:'#a78bfa', borderRadius:4 },
      { label:'Ready for QA', data:[
        openDefects.filter(d=>d.status==='Ready for QA'&&d.priority.includes('P1')).length,
        openDefects.filter(d=>d.status==='Ready for QA'&&d.priority.includes('P2')).length,
        openDefects.filter(d=>d.status==='Ready for QA'&&d.priority.includes('P3')).length
      ], backgroundColor:'#22d3ee', borderRadius:4 }
    ]
  },
  options: {
    responsive: true,
    plugins: { legend: { position:'bottom', labels:{ usePointStyle:true, padding:16 } } },
    scales: {
      x: { stacked: true },
      y: { stacked: true, beginAtZero:true, ticks:{ stepSize:1 } }
    }
  }
});

// ── Defect Table ──
const tbody = document.getElementById('defectsTable');
function badgeClass(status) {
  if (status === 'To Do') return 'badge-todo';
  if (status === 'Dev in Progress') return 'badge-inprogress';
  if (status === 'Done') return 'badge-done';
  if (status === 'Ready for QA') return 'badge-qa';
  if (status === 'Cancelled') return 'badge-cancelled';
  return '';
}
function priBadge(p) {
  if (p.includes('P1')) return 'badge-p1';
  if (p.includes('P2')) return 'badge-p2';
  return 'badge-p3';
}
defects.forEach(d => {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><a class="link" href="https://blendlabs.atlassian.net/browse/${d.key}" target="_blank">${d.key}</a></td>
    <td>${d.summary}</td>
    <td><span class="badge ${badgeClass(d.status)}">${d.status}</span></td>
    <td><span class="badge ${priBadge(d.priority)}">${d.priority}</span></td>
    <td>${d.assignee}</td>
    <td>${d.created}</td>
  `;
  tbody.appendChild(tr);
});
</script>
</body>
</html>
